<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<div id="div1"></div>
<div class="my-calendar" style="display: none">
    <!--<div class="validate-tip">-->
    <!--<div class="validate-tran"></div>-->
    <!--<span class="validate-tip-text">-->
    <!--<i class="fa fa-times-circle" aria-hidden="true"></i>-->
    <!--日期不能为空!-->
    <!--</span>-->
    <!--</div>-->

    <span class="calendar-input-wrapper">
<input type="text" class="calendar-input" readonly/>
</span>
    <div class="calendar">
        <header class="month-box">
            <span class="left-arrow"><</span>
            <select>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
            </select>月
            <span class="right-arrow">></span>
        </header>
        <table class="calendar-table">
            <tr>
                <td data-day="1">1</td>
                <td data-day="2">2</td>
                <td data-day="3">3</td>
                <td data-day="4">4</td>
                <td data-day="5">5</td>
                <td data-day="6">6</td>
                <td data-day="7">7</td>
            </tr>
            <tr>
                <td data-day="8">8</td>
                <td data-day="9">9</td>
                <td data-day="10">10</td>
                <td data-day="11">11</td>
                <td data-day="12">12</td>
                <td data-day="13">13</td>
                <td data-day="14">14</td>
            </tr>
            <tr>
                <td data-day="15">15</td>
                <td data-day="16">16</td>
                <td data-day="17">17</td>
                <td data-day="18">18</td>
                <td data-day="19">19</td>
                <td data-day="20">20</td>
                <td data-day="21">21</td>
            </tr>
            <tr>
                <td data-day="22">22</td>
                <td data-day="23">23</td>
                <td data-day="24">24</td>
                <td data-day="25">25</td>
                <td data-day="26">26</td>
                <td data-day="27">27</td>
                <td data-day="28">28</td>
            </tr>
            <tr>
                <td data-day="29">29</td>
                <td data-day="30">30</td>
                <td data-day="31">31</td>
            </tr>
        </table>
        <div>
            <button id="calendar-confirm-button" class="calendar-button confirm-button">
                确定
            </button>
            <button id="calendar-cancel-button" class="calendar-button cancel-button">
                取消
            </button>
        </div>
    </div>

</div>

<script>
/*
 * {
 *   inputWidth:213(单位px)
 * }
 * */
window.MyMonthlyCalendar = function MyMonthlyCalendar (el, options) {
  var MONTHS = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  var month = 1;
  var day = null;
  var input = null;
  var select;
  var confirmBtn;
  var cancelBtn;
  var table;
  var calendarDialog;
  if (!el) {
    throw new Error('el does not exist');
  }
  options = options || {};
  init(options);

  function init (options) {
    //initData(options);
    initDom(options);
//    boxes[1].imgEL.src = urls[curIndex];
//    buildImgUrl(boxes);
//    isAutoPlay && (timerId = setTimeout(autoPlay, cycle))
  }

  function initDom (options) {
    var frag = document.createDocumentFragment();
    var myCalendar = document.createElement('div');
    myCalendar.classList.add('my-calendar');
    frag.appendChild(myCalendar);
    myCalendar.appendChild(_initInput(options));

    calendarDialog = document.createElement('div');
    calendarDialog.classList.add('calendar');

    var calendarMain = document.createElement('div');
    calendarMain.classList.add('main');

    calendarDialog.appendChild(calendarMain);
    myCalendar.appendChild(calendarDialog);

    calendarMain.appendChild(_initMonthBox(options));
    calendarMain.appendChild(_initTable(options));
    calendarMain.appendChild(_initButton());

    el.appendChild(frag);
    function _initInput (options) {
      var inputWrapper = document.createElement('span');
      inputWrapper.classList.add('calendar-input-wrapper');

      input = document.createElement('input');
      input.classList.add('calendar-input');
      input.readOnly = true;
      input.type = 'text';
      input.style.width = options.inputWidth || 99 + 'px';

      input.addEventListener('focus', inputFocusHandler)
      inputWrapper.appendChild(input);
      return inputWrapper;
    }

    function _initMonthBox (options) {
      var header = document.createElement('header');
      header.classList.add('month-box');

      var leftArrow = document.createElement('span');
      leftArrow.classList.add('left-arrow');
      leftArrow.innerText = '<';

      _initSelector();

      var rightArrow = document.createElement('span');
      rightArrow.classList.add('right-arrow');
      rightArrow.innerText = '>';

      header.appendChild(leftArrow);
      header.appendChild(select);
      header.appendChild(document.createTextNode('月'));
      header.appendChild(rightArrow);

      return header;
      function _initSelector () {
        select = document.createElement('select');
        for (var i = 1; i < 13; i += 1) {
          var option = document.createElement('option');
          option.value = i;
          option.innerText = i;
          select.appendChild(option);
        }
        select.addEventListener('change', selectHandler)
      }
    }

    function _initTable (options) {
      table = document.createElement('table');
      table.classList.add('calendar-table');

      for (var i = 1; i < 6; i += 1) {
        var tr = document.createElement('tr');
        for (var j = 1; j < 8 && (i - 1) * 7 + j <= 31; j += 1) {
          var td = document.createElement('td');
          td.dataset.day = (i - 1) * 7 + j;
          td.innerText = (i - 1) * 7 + j;
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      table.addEventListener('click', tableHandler)
      return table;
    }

    function _initButton (options) {
      var div = document.createElement('div');
      div.classList.add('calendar-footer');

      confirmBtn = document.createElement('button');
      confirmBtn.classList.add('calendar-button');
      confirmBtn.classList.add('confirm-button');
      confirmBtn.innerText = '确认';
      confirmBtn.addEventListener('click', confirmHandler)

      cancelBtn = document.createElement('button');
      cancelBtn.classList.add('calendar-button');
      cancelBtn.classList.add('cancel-button');
      cancelBtn.innerText = '取消';
      cancelBtn.addEventListener('click', closeDialog)

      div.appendChild(confirmBtn);
      div.appendChild(cancelBtn);
      return div;
    }
  }

  function initData () {
    if (!input || !input.value) {
      reset();
      return;
    }
    var monthDay = input.value.split('-');
    month = Number(monthDay[0]);
    select.value = month;
    day = monthDay[1];

    initMonthStyles();
    checkDay()
  }

  function reset () {
    input.value = null;
    resetMonth();
    resetDay();
  }

  function resetMonth () {
    select.value = 1;
    month = 1;
  }

  function resetDay () {
    //day = null;
    var oldChecked = table.querySelector('.day-selected');
    oldChecked && oldChecked.classList.remove('day-selected');
    day = null;
  }

  function checkDay (dayEl) {
    var oldChecked = table.querySelector('.day-selected');
    oldChecked && oldChecked.classList.remove('day-selected');
    if (dayEl) {
      dayEl.classList.add('day-selected');
    } else {
      var td = table.querySelector('[data-day="' + day + '"]');
      td.classList.add('day-selected');
    }
  }

  function confirmHandler () {
    //有选择日
    if (!table.querySelector('.day-selected')) {
      return;
    }
    input.value = (month < 10 ? '0' + month : month) + '-' + (day < 10 ? '0' + day : day);
    closeDialog();
  }

  function inputFocusHandler (e) {
    if (calendarDialog.style.maxHeight) {
      return;
    }
    //reset();
    openDialog();
  }

  function calendarBlurHandler (e) {
    !calendarDialog.contains(e.target) && !input.contains(e.target) && closeDialog();
  }

  function openDialog () {
    document.addEventListener('click', calendarBlurHandler);
    initData();

    calendarDialog.style.maxHeight = '433px';
  }

  function closeDialog () {
    document.removeEventListener('click', calendarBlurHandler);
    calendarDialog.style.maxHeight = null;
  }

  function tableHandler (e) {//
    if (typeof e.target.dataset.day === 'undefined' || (typeof e.target.dataset.day === 'object' && !e.target.dataset.day)) {
      return;
    }
    var oldDay = day;
    day = Number(e.target.dataset.day);
    if (oldDay === day) {
      return;
    }
    checkDay(e.target);
  }

  function selectHandler (e) {//initial
    var cur = Number(e.target.value);
    if (cur === month) {
      return;
    }
    month = cur;
    initMonthStyles();
    resetDay();
  }

  function initMonthStyles () {
    if (MONTHS[month - 1] === 29) {
      table.querySelector('[data-day="30"]').style.display = 'none';
      table.querySelector('[data-day="31"]').style.display = 'none';
    } else if (MONTHS[month - 1] === 30) {
      table.querySelector('[data-day="30"]').style.display = 'table-cell';
      table.querySelector('[data-day="31"]').style.display = 'none';
    } else {
      table.querySelector('[data-day="30"]').style.display = 'table-cell';
      table.querySelector('[data-day="31"]').style.display = 'table-cell';
    }
  }

  function getValue () {
    if (!input) {
      return null;
    }
    return input.value;
  }

  return {
    getValue: getValue,
    reset: reset
  }
}

var c = new MyMonthlyCalendar(document.getElementById('div1'))
</script>
<style>
    .month-box {
        text-align: center;
        font-weight: bold;
    }

    .left-arrow {
        float: left;
        color: grey;
        cursor: pointer;
    }

    .right-arrow {
        float: right;
        color: grey;
        cursor: pointer;
    }

    .my-calendar {
        font-size: 14px;
    }

    .calendar {
        z-index: 128;
        position: absolute;
        color: black;
        border-radius: 5px;
        background: white;
        box-shadow: 0px 0px 5px;
        margin-top: .5em;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.25s
    }

    .calendar .main {
        padding: 11px;
    }

    .calendar:focus {
        outline: none;
    }

    .calendar-input-wrapper {
        position: relative;
        border: 1px solid #D4D4D4;
        background-color: #fff;
        vertical-align: middle;
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        padding: 0;
        height: 28px;
    }

    .calendar-input {
        height: 28px;
        outline: 0;
        border: 0;
        margin: 0;
        padding: 0 4px;
        white-space: normal;
        vertical-align: top;
        outline-style: none;
        resize: none;
    }

    .calendar-input-validate-failed {
        border: 1px solid red;
    }

    .calendar .calendar-table {
        border-bottom: 1px solid #eeeeee;
        padding: 15px 0;
        margin-bottom: 11px;
        text-align: center;
        box-sizing: content-box;
        user-select: none;
    }

    .calendar .calendar-table td {
        cursor: pointer;
        border-radius: 3px;
        padding: 0.3em;
    }

    .calendar-table td:hover {
        background: #d5eafd;
        color: white;
    }

    .calendar-table .day-selected {
        background: #2e94f8;
        color: white;
    }

    .calendar-footer {
        overflow: hidden;
    }

    .calendar-button {
        display: inline-block;
        line-height: 22px;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        -ms-touch-action: manipulation;
        touch-action: manipulation;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid #d4cdcd;
        border-radius: 4px;
        padding: 0 1em;
    }

    .confirm-button {
        background: #2e94f8;
        color: white;
        float: right;
        margin-left: 11px;
    }

    .cancel-button {
        background: white;
        float: right;
    }

    .validate-tip {
        position: absolute;
        top: -28px;
        z-index: 1024;
        display: none;
    }

    .validate-tran {
        position: absolute;
        width: 0px;
        height: 0px;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 0;
        border-top: 10px solid #f8eeee;
        left: 0;
        right: 0;
        margin: auto;
        bottom: -11px;
    }

    .validate-tip-text {
        padding: 5px;
        border: 1px solid #eeeeee;
        color: red;
        background: #f8eeee;
    }
</style>
</body>
</html>